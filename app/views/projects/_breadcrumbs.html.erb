<%# app/views/projects/_breadcrumbs.html.erb %>
<%# File-path style breadcrumb navigation: LIBRARY / Project / Folder / Subfolder %>

<nav class="breadcrumbs" aria-label="Breadcrumb navigation">
  <%# LIBRARY - always links back to main library %>
  <%= link_to "LIBRARY", root_path, class: "breadcrumb-link", data: { folder_id: "root", action: "dragover->file-drag#breadcrumbDragOver dragleave->file-drag#breadcrumbDragLeave drop->file-drag#breadcrumbDrop" } %>

  <span class="breadcrumb-separator">/</span>

  <%# Project name - links to project root (no folder_id) %>
  <% if @current_folder %>
    <%= link_to @project.title, project_path(@project), class: "breadcrumb-link", data: { folder_id: "project_root", action: "dragover->file-drag#breadcrumbDragOver dragleave->file-drag#breadcrumbDragLeave drop->file-drag#breadcrumbDrop" } %>

    <%# Build and display folder chain %>
    <%
      # Walk up the tree to build ancestry
      ancestors = []
      folder = @current_folder
      while folder
        # Skip the auto-skipped root folder from breadcrumbs
        unless @skipped_root_folder && folder.id == @skipped_root_folder.id
          ancestors.unshift(folder)
        end
        folder = folder.parent
      end

      ancestors.each_with_index do |ancestor, index|
    %>
      <span class="breadcrumb-separator">/</span>
      <% if index == ancestors.length - 1 %>
        <span class="breadcrumb-current"><%= ancestor.original_filename %></span>
      <% else %>
        <%= link_to ancestor.original_filename, project_path(@project, folder_id: ancestor.id), class: "breadcrumb-link", data: { folder_id: ancestor.id, action: "dragover->file-drag#breadcrumbDragOver dragleave->file-drag#breadcrumbDragLeave drop->file-drag#breadcrumbDrop" } %>
      <% end %>
    <% end %>
  <% else %>
    <%# At project root - show as current (not linked) %>
    <span class="breadcrumb-current"><%= @project.title %></span>
  <% end %>
</nav>

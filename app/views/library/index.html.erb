<h1 class="page-title">LIBRARY</h1>

<div class="add-project-btn" id="add-project-btn">
  + Add projects
</div>

<%= form_with model: Project.new, id: "upload-form" do |f| %>
  <%= f.file_field :file, class: "file-input", id: "file-input", accept: ".als,.logicx,.wav,.mp3,.zip" %>

  <div id="file-details" style="display: none;">
    <p id="selected-file-title" style="text-align: center; margin-bottom: 10px;"></p>
    <%= f.text_field :title, placeholder: "Project title", class: "project-title-input", id: "project-title-input" %>
    <%= f.submit "Upload", class: "upload-btn" %>
  </div>
<% end %>

<div class="drop-zone" id="drop-zone">
  <% if current_user.projects.any? %>
    <div class="projects-grid">
      <% current_user.projects.each do |project| %>
        <div class="project-card-wrapper">
          <% if project.file.attached? %>
            <%= link_to project_path(project), class: "project-card" do %>
              <div class="project-icon">
                <%= image_tag project_icon_for(project), class: "icon-image" %>
              </div>
              <p><%= project.title %><%= File.extname(project.file.filename.to_s) %></p>
            <% end %>
          <% else %>
            <div class="project-card">
              <div class="project-icon">
                <%= image_tag project_icon_for(project), class: "icon-image" %>
              </div>
              <p><%= project.title %></p>
            </div>
          <% end %>

          <%# Three-dot menu for actions %>
          <% if project.file.attached? %>
            <div class="card-menu" data-controller="dropdown">
              <button class="menu-trigger" data-action="click->dropdown#toggle">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                  <circle cx="3" cy="8" r="1.5"/>
                  <circle cx="8" cy="8" r="1.5"/>
                  <circle cx="13" cy="8" r="1.5"/>
                </svg>
              </button>
              <div class="menu-dropdown" data-dropdown-target="menu">
                <%= link_to "Download", download_project_path(project), class: "menu-item" %>
                <div class="menu-divider"></div>
                <%= link_to "Delete", project_path(project),
                    method: :delete,
                    data: { turbo_method: :delete, turbo_confirm: "Delete '#{project.title}'? This cannot be undone." },
                    class: "menu-item menu-item-danger" %>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  <% else %>
    <p class="empty-state">Drag & drop files here or use the button above</p>
  <% end %>
</div>

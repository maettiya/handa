<% content_for :page_title, "PROFILE" %>

<div class="profile-container">

  <!-- Profile Photo -->
  <div class="profile-photo-section">
    <div class="profile-photo">
      <% if @user.avatar.attached? %>
        <%= image_tag @user.avatar, class: "avatar-image" %>
      <% else %>
        <div class="avatar-placeholder">
          <%= @user.username.first.upcase %>
        </div>
      <% end %>
    </div>
    <%= form_with model: @user, url: profile_path, method: :patch, class: "avatar-form" do |f| %>
      <%= f.file_field :avatar, class: "file-input", id: "avatar-input", accept: "image/*" %>
      <label for="avatar-input" class="change-photo-btn">Change photo</label>
    <% end %>
  </div>

  <!-- Stats Row -->
  <div class="profile-stats">
    <%= link_to root_path, class: "stat-item stat-link" do %>
      <div class="stat-value"><%= @user.daw_projects_count %></div>
      <div class="stat-label">Projects</div>
    <% end %>
    <div class="stat-divider"></div>
    <%= link_to collaborators_path, class: "stat-item stat-link" do %>
      <div class="stat-value"><%= @user.collaborators_count %></div>
      <div class="stat-label">Collaborators</div>
    <% end %>
  </div>

  <!-- File Types Breakdown -->
  <% if @total_storage > 0 %>
    <div class="profile-breakdown">
      <div class="breakdown-bar">
        <% if @storage_breakdown[:daw] > 0 %>
          <div class="breakdown-segment daw" style="width: <%= @storage_breakdown[:daw] %>%"></div>
        <% end %>
        <% if @storage_breakdown[:lossless] > 0 %>
          <div class="breakdown-segment lossless" style="width: <%= @storage_breakdown[:lossless] %>%"></div>
        <% end %>
        <% if @storage_breakdown[:compressed] > 0 %>
          <div class="breakdown-segment compressed" style="width: <%= @storage_breakdown[:compressed] %>%"></div>
        <% end %>
        <% if @storage_breakdown[:other] > 0 %>
          <div class="breakdown-segment other" style="width: <%= @storage_breakdown[:other] %>%"></div>
        <% end %>
      </div>
      <div class="breakdown-legend">
        <% if @storage_breakdown[:daw] > 0 %>
          <div class="legend-item">
            <span class="legend-dot daw"></span>
            <span>DAW Projects <%= @storage_breakdown[:daw] %>%</span>
          </div>
        <% end %>
        <% if @storage_breakdown[:lossless] > 0 %>
          <div class="legend-item">
            <span class="legend-dot lossless"></span>
            <span>Lossless <%= @storage_breakdown[:lossless] %>%</span>
          </div>
        <% end %>
        <% if @storage_breakdown[:compressed] > 0 %>
          <div class="legend-item">
            <span class="legend-dot compressed"></span>
            <span>Compressed <%= @storage_breakdown[:compressed] %>%</span>
          </div>
        <% end %>
        <% if @storage_breakdown[:other] > 0 %>
          <div class="legend-item">
            <span class="legend-dot other"></span>
            <span>Other <%= @storage_breakdown[:other] %>%</span>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <!-- Profile Fields -->
  <div class="profile-fields">

    <!-- Username -->
    <div class="profile-field">
      <label>Username</label>
      <div class="field-value"><%= @user.username %></div>
      <%= link_to "Edit", edit_profile_path(field: :username), class: "field-action" %>
    </div>

    <!-- Storage Usage -->
    <div class="profile-field">
      <label>Storage</label>
      <div class="field-value">
        <span><%= number_to_human_size(@total_storage) %> of 10 GB used</span>
      </div>
      <%= link_to "10 GB Limit", "#", class: "field-action" %>
    </div>

    <!-- Email -->
    <div class="profile-field">
      <label>Email</label>
      <div class="field-value"><%= @user.email %></div>
      <%= link_to "Edit", edit_profile_path(field: :email), class: "field-action" %>
    </div>

    <!-- Password -->
    <div class="profile-field">
      <label>Password</label>
      <div class="field-value">••••••••</div>
      <%= link_to "Change", edit_profile_path(field: :password), class: "field-action" %>
    </div>
  </div>

  <!-- Sign Out -->
  <div class="profile-sign-out">
    <%= button_to "Sign out", destroy_user_session_path, method: :delete, class: "sign-out-link" %>
  </div>
</div>
